from dataclasses import dataclass

import database.row_object
import syntax_tree.syntax_tree_node_object
import syntax_tree.syntax_tree_service


@dataclass
class CodeSource:
    file_name: str
    file_path: str
    raw_text: str
    text_view: str
    syntax_tree_view: syntax_tree.syntax_tree_node_object.SyntaxTreeNode | None

    def __init__(self):
        self.file_name = ''
        self.file_path = ''
        self.raw_text = ''
        self.text_view = ''
        self.syntax_tree_view = None

    def to_database_row(self) -> database.row_object.Row:
        tree_json = syntax_tree.syntax_tree_service.SyntaxTreeService.serialize_syntax_tree_node(self.syntax_tree_view)
        return database.row_object.Row(
            name=self.file_path,
            text_view=self.text_view,
            syntax_tree_view=tree_json
        )


